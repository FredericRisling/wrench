<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.17"/>
    <title>WRENCH: Creating a batch compute service</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="bootstrap.min.css">
    <script src="bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="https://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.8-dev
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li class="nav-item"><a class="nav-link" href="/wrench/1.8-dev/index.html">Overview</a></li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.8-dev/install.html">Installation</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.8-dev/getting-started.html">Getting
                    Started</a></li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.8-dev/wrench-101.html">WRENCH 101</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.8-dev/wrench-102.html">WRENCH 102</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">APIs Reference</a>
                    <div class="dropdown-menu">
                        <a class="small dropdown-item" href="/wrench/1.8-dev/user/annotated.html">User</a>
                        <a class="small dropdown-item"
                           href="/wrench/1.8-dev/developer/annotated.html">Developer</a>
                        <a class="small dropdown-item"
                           href="/wrench/1.8-dev/internal/annotated.html">Internal</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top" style="padding-top: 4em !important"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating a batch compute service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="guide-batch-overview"></a>
Overview</h1>
<p>A batch service is a service that makes it possible to run jobs on a homogeneous cluster managed by a batch scheduler. The batch scheduler receives requests that ask for a number of compute nodes, with a number of cores per compute node, and a duration. Requests wait in a queue and, using a range of possible batch scheduling algorithms, are dispatched to the requested compute resources in a space-sharing manner. Therefore, a job submitted to the service experiences a "queue waiting time" period (the length of which depends on the load on the service) followed by an "execution time" period. In typical batch-scheduler fashion, a running job is forcefully terminated when it reaches its requested duration (i.e., the job fails). If, instead, the job completes before the requested duration, it succeeds. In both cases, the job's allocated compute resources are reclaimed by the batch scheduler.</p>
<p>A batch service also supports so-called "pilot jobs", i.e., jobs that are submitted to the service, with requested resources and duration, but without specifying at submission time which workflow tasks/operations should be performed by the job. Instead, once the job starts it exposes to its submitter a <a class="el" href="guide-101-baremetal.html">bare-metal</a> service. This service is available only for the requested duration, and can be used in any manner by the submitter. This allows late binding of workflow tasks to compute resources.</p>
<h1><a class="anchor" id="guide-batch-creating"></a>
Creating a batch compute service</h1>
<p>In WRENCH, a batch service is defined by the <code><a class="el" href="classwrench_1_1_batch_compute_service.html" title="A batch-scheduled compute service that manages a set of compute hosts and controls access to their re...">wrench::BatchComputeService</a></code> class. An instantiation of a batch service requires the following parameters:</p>
<ul>
<li>The name of a host on which to start the service;</li>
<li>A list (<code>std::vector</code>) of hostnames (all cores and all RAM of each host is available to the batch service);</li>
<li>A mount point (corresponding to a disk attached to the host) for the scratch space, i.e., storage local to the batch service (used to store workflow files, as needed, during job executions); and</li>
<li>Maps (<code>std::map</code>) of configurable properties (<code><a class="el" href="classwrench_1_1_batch_compute_service_property.html" title="Configurable properties for a BatchComputeService.">wrench::BatchComputeServiceProperty</a></code>) and configurable message payloads (<code><a class="el" href="classwrench_1_1_batch_compute_service_message_payload.html" title="Configurable message payloads for a batch.">wrench::BatchComputeServiceMessagePayload</a></code>).</li>
</ul>
<p>The example below creates an instance of a batch service that runs on host <code>Gateway</code> and provides access to 4 hosts (using all their cores and RAM), with scratch space on the disk mounted at path <code>/scratch/</code> at host <code>Gateway</code>. Furthermore, the batch scheduling algorithm is configured to use the FCFS (First-Come-First-Serve) algorithm, and the message with which the service answers resource request description requests is configured to be 1KiB:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> batch_cs = simulation-&gt;add(</div>
<div class="line">          <span class="keyword">new</span> <a class="code" href="classwrench_1_1_batch_compute_service.html">wrench::BatchComputeService</a>(<span class="stringliteral">&quot;Gateway&quot;</span>,</div>
<div class="line">                                   {<span class="stringliteral">&quot;Node1&quot;</span>, <span class="stringliteral">&quot;Node2&quot;</span>, <span class="stringliteral">&quot;Node3&quot;</span>, <span class="stringliteral">&quot;Node4&quot;</span>},</div>
<div class="line">                                   <span class="stringliteral">&quot;/scratch/&quot;</span>,</div>
<div class="line">                                   {{<a class="code" href="classwrench_1_1_batch_compute_service_property.html#a4e88135150aea2df7f815f7d751f03c7">wrench::BatchComputeServiceProperty::BATCH_SCHEDULING_ALGORITHM</a>, <span class="stringliteral">&quot;FCFS&quot;</span>}},</div>
<div class="line">                                   {{<a class="code" href="classwrench_1_1_compute_service_message_payload.html#a110f501ef6361a70627833e8ab5ab511">wrench::BareMetalComputeServiceMessagePayload::RESOURCE_DESCRIPTION_ANSWER_MESSAGE_PAYLOAD</a>, 1024}});</div>
</div><!-- fragment --><p>See the documentation of <code><a class="el" href="classwrench_1_1_batch_compute_service_property.html" title="Configurable properties for a BatchComputeService.">wrench::BatchComputeServiceProperty</a></code> and <code><a class="el" href="classwrench_1_1_batch_compute_service_message_payload.html" title="Configurable message payloads for a batch.">wrench::BatchComputeServiceMessagePayload</a></code> for all possible configuration options.</p>
<p>Also see the simulators in the <code>examples/basic-examples/batch-*/</code> directories, which use batch compute services. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclasswrench_1_1_batch_compute_service_html"><div class="ttname"><a href="classwrench_1_1_batch_compute_service.html">wrench::BatchComputeService</a></div><div class="ttdoc">A batch-scheduled compute service that manages a set of compute hosts and controls access to their re...</div><div class="ttdef"><b>Definition:</b> BatchComputeService.h:49</div></div>
<div class="ttc" id="aclasswrench_1_1_compute_service_message_payload_html_a110f501ef6361a70627833e8ab5ab511"><div class="ttname"><a href="classwrench_1_1_compute_service_message_payload.html#a110f501ef6361a70627833e8ab5ab511">wrench::ComputeServiceMessagePayload::RESOURCE_DESCRIPTION_ANSWER_MESSAGE_PAYLOAD</a></div><div class="ttdeci">static const std::string RESOURCE_DESCRIPTION_ANSWER_MESSAGE_PAYLOAD</div><div class="ttdoc">The number of bytes in the control message sent by the daemon to state information on its resources.</div><div class="ttdef"><b>Definition:</b> ComputeServiceMessagePayload.h:58</div></div>
<div class="ttc" id="aclasswrench_1_1_batch_compute_service_property_html_a4e88135150aea2df7f815f7d751f03c7"><div class="ttname"><a href="classwrench_1_1_batch_compute_service_property.html#a4e88135150aea2df7f815f7d751f03c7">wrench::BatchComputeServiceProperty::BATCH_SCHEDULING_ALGORITHM</a></div><div class="ttdeci">static const std::string BATCH_SCHEDULING_ALGORITHM</div><div class="ttdoc">The batch scheduling algorithm. Can be:</div><div class="ttdef"><b>Definition:</b> BatchComputeServiceProperty.h:43</div></div>
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<div class="footer">
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <p>
                    <strong>&copy;2017-2020 WRENCH. All Rights Reserved.</strong><br />
                </p>
                <p style="padding-top: 1em">
                    <a href="mailto:support@wrench-project.org" class="fa-stack fa-2x" style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fa fa-envelope fa-stack-1x"></i>
                    </a>
                    <a href="http://twitter.com/wrenchproject" target="_blank" class="fa-stack fa-2x"
                       style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fab fa-twitter fa-stack-1x"></i>
                    </a>
                    <a href="https://github.com/wrench-project/wrench" target="_blank" class="fa-stack fa-2x"
                       style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fab fa-github fa-stack-1x"></i>
                    </a>
                </p>
            </div>
            <div class="col-sm-4 text-center">
            </div>
            <div class="col-sm-4">
                <p>WRENCH is funded by the National Science Foundation (NSF) under grants number <a
                        href="https://nsf.gov/awardsearch/showAward?AWD_ID=1642369" target="_blank">1642369</a>,
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1642335" target="_blank">1642335</a>,
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923539" target="_blank">1923539</a>, and
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923621" target="_blank">1923621</a>;
                    and the National Center for Scientific Research (CNRS) under grant number PICS07239.
                </p>
                <p style="font-weight: normal; font-size: 0.8em; margin-top: 1em">
                    Any opinions, findings, and conclusions or recommendations expressed in this material are those
                    of the author(s) and do not necessarily reflect the views of the National Science Foundation.
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
