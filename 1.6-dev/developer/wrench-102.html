<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.13"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>WRENCH: WRENCH 102</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
    <!-- SmartMenus jQuery plugin -->
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="http://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.6-dev
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li><a href="index.html">Overview</a></li>
                <li><a href="install.html">Installation</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="wrench-101.html">WRENCH 101</a></li>
                <li><a href="wrench-102.html">WRENCH 102</a></li>
                <li><a href="annotated.html">API Reference</a></li>
                <li style="float: right">
                    <input type="hidden" id="MSearchField">
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">WRENCH 102 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#wrench-102-WMS-10000ft">Basic blueprint for a WMS implementation</a></li>
<li class="level1"><a href="#wrench-102-obtain-information">A) Obtaining information about services</a></li>
<li class="level1"><a href="#wrench-102-WMS-services">B)  Interacting with  services</a><ul><ul><li class="level3"><a href="#wrench-102-jobs">The Job  abstraction</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#wrench-102-WMS-events">C) Workflow execution events</a></li>
<li class="level1"><a href="#wrench-102-WMS-exceptions">Exceptions</a></li>
<li class="level1"><a href="#wrench-102-WMS-schedulers">Schedulers for decision-making</a></li>
<li class="level1"><a href="#wrench-102-WMS-logging">Logging</a></li>
</ul>
</div>
<div class="textblock"><p>A Workflow Management System (WMS) is software that makes all decisions and takes all actions for executing a workflow using cyberinfrastructure services. It is thus a crucial component in every WRENCH simulator. WRENCH does not provide any WMS implementation, but provides the means for developing custom WMSs. This page is meant to provide high-level and detailed information about implementing a Workflow Management System (WMS) in WRENCH. Full API details are provided in the <a href="../developer/annotated.html">Developer API Reference</a>.</p>
<hr/>
<h1><a class="anchor" id="wrench-102-WMS-10000ft"></a>
Basic blueprint for a WMS implementation</h1>
<p>A WMS implementation needs to use many WRENCH classes, which are accessed by including a single header file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;wrench-dev.h&gt;</span></div></div><!-- fragment --><p>A WMS implementation must derive the <code><a class="el" href="classwrench_1_1_w_m_s.html" title="A workflow management system (WMS) ">wrench::WMS</a></code> class, which means that it can override several virtual methods, but also that a WMS is a service. As such, it has a <code>main()</code> function that goes through a simple loop as follows:</p>
<div class="fragment"><div class="line">// A) obtain information about running services</div><div class="line">while (workflow execution isn&#39;t completed/failed) {</div><div class="line">  // B) interact with services </div><div class="line">  // C) wait for an event and react to it</div><div class="line">}</div></div><!-- fragment --><p>The next three sections we give detailed on how to do A, B, and C in the code above. To provide context we make frequent references to the WMS implementations in the example simulators in the <code>examples/</code> directory. Afterwards are a few sections that highlight features and functionality relevant to WMS development.</p>
<h1><a class="anchor" id="wrench-102-obtain-information"></a>
A) Obtaining information about services</h1>
<h2>Discovering running services</h2>
<p>The <code><a class="el" href="classwrench_1_1_w_m_s.html" title="A workflow management system (WMS) ">wrench::WMS</a></code> base class implements a set of methods named <code><a class="el" href="classwrench_1_1_w_m_s.html#ae875a712cde823ebd34fd062372cba23" title="Obtain the list of compute services available to the WMS. ">wrench::WMS::getAvailableComputeServices()</a></code>, <code><a class="el" href="classwrench_1_1_w_m_s.html#a8cf286e98f516f19f1bbf2d4bca3dd41" title="Obtain the list of compute services available to the WMS. ">wrench::WMS::getAvailableStorageServices()</a></code>, <code><a class="el" href="classwrench_1_1_w_m_s.html#a6bebac8806781de9c979b20082bcbe35" title="Obtain the list of network proximity services available to the WMS. ">wrench::WMS::getAvailableNetworkProximityServices()</a></code>, etc. These methods return sets of services that can be used by the WMS to execute its workflow. Some of these methods are templated to retrieve only a particular kind of services. For instance, the <code><a class="el" href="classwrench_1_1_w_m_s.html#ae875a712cde823ebd34fd062372cba23" title="Obtain the list of compute services available to the WMS. ">wrench::WMS::getAvailableComputeServices()</a></code> takes a template argument to retrieve particular kinds of compute services. In the example simulator in <code>examples/basic-examples/bare-metal-chain</code>, the WMS implementation in <code>OneTaskAtATimeWMS.cpp</code> includes the following call:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> compute_service = *(this-&gt;getAvailableComputeServices&lt;BareMetalComputeService&gt;().begin());</div></div><!-- fragment --><p>This call stores the first of the bare-metal compute services available to the WMS for executing workflow tasks in the <code>compute_service</code> variable. In this example the simulator always passes exactly one bare-metal service to the WMS, so this code is valid. However, <code><a class="el" href="classwrench_1_1_w_m_s.html#ae875a712cde823ebd34fd062372cba23" title="Obtain the list of compute services available to the WMS. ">wrench::WMS::getAvailableComputeServices</a>&lt;T&gt;()</code> can return an empty set.</p>
<p>The above methods (as well as, for instance, <code><a class="el" href="classwrench_1_1_simulation.html#a7cf70e5793758149a8bf29992d870c91" title="Method to add a service to the simulation. ">wrench::Simulation::add()</a></code>) return shared pointers (i.e., <code>std::shared_ptr&lt;&gt;</code>) to the service instances. This is to free the developer from the responsibility of freeing memory.</p>
<h2>Finding out information about running services</h2>
<p>Most service classes provide methods to get information about the capabilities and properties of the services. For instance, a <code><a class="el" href="classwrench_1_1_compute_service.html" title="The compute service base class. ">wrench::ComputeService</a></code> has a <code><a class="el" href="classwrench_1_1_compute_service.html#a1b576a22529bd638e6998f0513a44b36" title="Get the number of hosts that the compute service manages. ">wrench::ComputeService::getNumHosts()</a></code> method that returns how many compute hosts the service has access to in total. A <code><a class="el" href="classwrench_1_1_storage_service.html" title="The storage service base class. ">wrench::StorageService</a></code> has a <code><a class="el" href="classwrench_1_1_storage_service.html#a3670e4f065a732e8430114d332eef7f3" title="Synchronously asks the storage service for its capacity at all its mount points. ">wrench::StorageService::getFreeSpace()</a></code> method to find out have many bytes of free space are available on it. And so on...</p>
<p>To take a concrete example, consider the WMS implementation in <code>examples/basic-examples/batch-bag-of-tasks/TwoTasksAtATimeBatchWMS.cpp</code>. This WMS finds out the compute speed of the cores of the compute nodes available to a <code><a class="el" href="classwrench_1_1_batch_compute_service.html" title="A batch-scheduled compute service that manages a set of compute hosts and controls access to their re...">wrench::BatchComputeService</a></code> as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> core_flop_rate = (*(batch_service-&gt;getCoreFlopRate().begin())).second;</div></div><!-- fragment --><p>Method <code><a class="el" href="classwrench_1_1_compute_service.html#a72c2608b82692ad73888d9b9f7c6bd0c" title="Get the per-core flop rate of the compute service&#39;s hosts. ">wrench::ComputeService::getCoreFlopRate()</a></code> returns a map of core compute speeds indexed by hostname (the map thus has one element per compute node available to the service). Since the compute nodes of a batch compute service are homogeneous, the above code simply grabs the core speed value of the first element in the map.</p>
<p>It is important to note that these methods actually involve communication with the service, and thus incur overhead that is part of the simulation (as if, in the real-world, you would contact a running service with a request for information over the network). This is why the line of code above, in that example WMS, is executed once and the core compute speed is stored in the <code>core_flop_rate</code> variable to be re-used by the WMS repeatedly throughout its execution.</p>
<h1><a class="anchor" id="wrench-102-WMS-services"></a>
B)  Interacting with  services</h1>
<p>A WMS can have many and complex interactions with services, especially with compute and storage services. In this section we describe how WRENCH makes these interactions relatively easy, providing examples for each kind of interaction for each kind of service.</p>
<h2>Job Manager and Data Movement Manager</h2>
<p>As expected, each service type provides its own API. For instance, a network proximity service provides methods to query the service's host distance databases. The <a href="../developer/annotated.html">Developer API Reference</a> provides all necessary documentation, which also explains which methods are synchronous and which are asynchronous (in which case some <a class="el" href="wrench-102.html#wrench-102-WMS-events">event</a> will occur in the future). <b>However, the WRENCH developer will find that many methods that one would expect are nowhere to be found. For instance, the compute services do not have methods for submitting workflow tasks for execution!</b></p>
<p>The rationale for the above is that many methods need to be asynchronous so that the WMS can use services concurrently. For instance, a WMS could submit a compute job to two distinct compute services asynchronously, and then wait for the service which completes its job first and cancel the job on the other service. Exposing this asynchronicity to the WMS would require that the WRENCH developer use data structures to perform the necessary bookkeeping of ongoing service interactions, and process incoming control messages from the services on the (simulated) network or alternately register many callbacks. Instead, WRENCH provides <b>managers</b>. One can think of managers are separate threads that handle all asynchronous interactions with services, and which have been implemented for your convenience to make interacting with services easy.</p>
<p>There are two managers: a <b>job manager</b> (class <code><a class="el" href="classwrench_1_1_job_manager.html" title="A helper daemon (co-located with and explicitly started by a WMS), which is used to handle all job ex...">wrench::JobManager</a></code>) and a <b>data movement manager</b> (class <code><a class="el" href="classwrench_1_1_data_movement_manager.html" title="A helper daemon (co-located with a WMS) that handles data movement operations. ">wrench::DataMovementManager</a></code>). The base <code><a class="el" href="classwrench_1_1_w_m_s.html" title="A workflow management system (WMS) ">wrench::WMS</a></code> class provides two methods for instantiating and starting these managers: <code><a class="el" href="classwrench_1_1_w_m_s.html#a3f1a1451efda2a41d2d96a41cf229698" title="Instantiate and start a job manager. ">wrench::WMS::createJobManager()</a></code> and <code><a class="el" href="classwrench_1_1_w_m_s.html#aaf8902aadfd0542509cd0cae5519bcf3" title="Instantiate and start a data movement manager. ">wrench::WMS::createDataMovementManager()</a></code>.</p>
<p>Creating these managers typically is the first thing a WMS does. For instance, the WMS in <code>examples/basic-examples/bare-metal-data-movement/DataMovementWMS.cpp</code> starts by doing:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> job_manager = this-&gt;createJobManager();</div><div class="line"><span class="keyword">auto</span> data_movement_manager = this-&gt;createDataMovementManager();</div></div><!-- fragment --><p>Each manager has its own documented API, and is discussed further in sections below.</p>
<h2>Interacting with storage services</h2>
<p>The possible interactions between a WMS and a storage service include:</p>
<ul>
<li>Synchronously check that a file exists</li>
<li>Synchronously read a file (rarely used by a WMS but included for completeness)</li>
<li>Synchronously write a file (rarely used by a WMS but included for completeness)</li>
<li>Synchronously delete a file</li>
<li>Synchronously copy a file from one storage service to another</li>
<li>Asynchronously copy a file from one storage service to another</li>
</ul>
<p>The first 4 interactions above are done by calling methods of the <code><a class="el" href="classwrench_1_1_storage_service.html" title="The storage service base class. ">wrench::StorageService</a></code> class. The last two are done via a Data Movement Manager, i.e., by calling methods of the <code><a class="el" href="classwrench_1_1_data_movement_manager.html" title="A helper daemon (co-located with a WMS) that handles data movement operations. ">wrench::DataMovementManager</a></code> class. Some of these methods take an optional <code><a class="el" href="classwrench_1_1_file_registry_service.html" title="A file registry service (a.k.a. replica catalog) that holds a database of which files are available a...">wrench::FileRegistryService</a></code> argument, in which case they will also update entries in a file registry service (e.g., removing an entry when a file is deleted).</p>
<p>See <a class="el" href="guide-102-simplestorage.html">this page</a> for concrete examples of interactions with a <code><a class="el" href="classwrench_1_1_simple_storage_service.html" title="A storage service that provides direct access to some storage resources (e.g., one or more disks)...">wrench::SimpleStorageService</a></code>.</p>
<h2>Interacting with compute services</h2>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer">
    <small>
        Generated by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
    </a> 1.8.13
    </small>
</address>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
