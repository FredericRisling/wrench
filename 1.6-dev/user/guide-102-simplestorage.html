<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.17"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>WRENCH: Interacting with a storage service</title>
    <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
    <!-- SmartMenus jQuery plugin -->
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="http://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.6-dev
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li><a href="index.html">Overview</a></li>
                <li><a href="install.html">Installation</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="wrench-101.html">WRENCH 101</a></li>
                <li><a href="wrench-102.html">WRENCH 102</a></li>
                <li><a href="annotated.html">API Reference</a></li>
                <li style="float: right">
                    <input type="hidden" id="MSearchField">
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Interacting with a storage service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Several interactions with a storage service are done simple by calling <b>static methods</b> of the <code><a class="el" href="classwrench_1_1_storage_service.html" title="The storage service base class.">wrench::StorageService</a></code> class. These make it possible to lookup, delete, read, and write files. For instance:</p>
<div class="fragment"><div class="line"><span class="comment">// Get the first simple storage service (assuming there&#39;s at least one)</span></div>
<div class="line"><span class="keyword">auto</span> storage_service = *(this-&gt;getAvailableComputeServices&lt;wrench::SimpleStorageService&gt;().begin());</div>
<div class="line"><span class="comment">// Get the file registry service</span></div>
<div class="line"><span class="keyword">auto</span> file_registry = this-&gt;getAvailableFileRegistryService();</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwrench_1_1_workflow_file.html">wrench::WorkflowFile</a> *some_file = ...;</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check whether the storage service holds the file at path /data/ and delete it if so</span></div>
<div class="line"><span class="keyword">auto</span> file_location = wrench::FileLocation::LOCATION(storage_service, <span class="stringliteral">&quot;/data/&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (wrench::StorageService::lookupFile(some_file, file_location) {</div>
<div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;File found!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  wrench::StorageService::deleteFile(some_file, file_location, file_registry);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that the file registry service is passed to the <code>wrench::StorageService::deleteFile()</code> method since the file deletion should cause the file registry to remove one of its entries.</p>
<p>Reading and writing files is something a WMS typically does not do directly (instead, workflow tasks read and write files as they execute). But, if for some reason a WMS needs to spend time doing file I/O, it is easily done:</p>
<div class="fragment"><div class="line"><span class="comment">// Read some file from the &quot;/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This does nothing but simulate a time overhead during which the WMS is busy</span></div>
<div class="line">wrench::StorageService::readFile(some_file, wrench::FileLocation::LOCATION(storage_service, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write some file to the &quot;/stuff/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This simulates a time overhead after which the storage service will host the file. It</span></div>
<div class="line"><span class="comment">// is a good idea to then add an entry to the file registry service</span></div>
<div class="line">wrench::StorageService::writeFile(some_file, wrench::FileLocation::LOCATION(storage_service, <span class="stringliteral">&quot;/stuff/&quot;</span>);</div>
</div><!-- fragment --><p>An operation commonly performed by a WMS is copying files between storage services (e.g., to enforce some data locality). This is typically done by specifying file copy operations as part of standard jobs. But it can also be done manually by the WMS via the data movement manager's methods <code>wrench::DataMovementManager::doSynchronousFileCopy()</code> and <code>wrench::DataMovementManager::initiateAsynchronousFileCopy()</code>. Here is an example in which a file is copied between storage services:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a data movement manager</span></div>
<div class="line"><span class="keyword">auto</span> data_movement_manager = this-&gt;createDataMovementManager();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Synchronously copy some_file from storage_service1 to storage_service2</span></div>
<div class="line"><span class="comment">// While this is taking place, the WMS is busy</span></div>
<div class="line">data_movement_manager-&gt;doSynchronousFileCopy(some_file, wrench::FileLocation::LOCATION(storage_service1), wrench::FileLocation::LOCATION(storage_service2));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Asynchronously copy some_file from storage_service2 to storage_service3</span></div>
<div class="line">data_movement_manager-&gt;initiateAsynchronousFileCopy(some_file, wrench::FileLocation::LOCATION(storage_service2), wrench::FileLocation::LOCATION(storage_service3));</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for and process the next event (may be a file copy completion or failure)</span></div>
<div class="line">this-&gt;waitForAndProcessNextEvent();</div>
</div><!-- fragment --><p>See the WMS implementation in <code>examples/basic-examples/bare-metal-data-movement/DataMovementWMS.cpp</code> for a more complete example. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclasswrench_1_1_workflow_file_html"><div class="ttname"><a href="classwrench_1_1_workflow_file.html">wrench::WorkflowFile</a></div><div class="ttdoc">A data file used/produced by a WorkflowTask in a Workflow.</div><div class="ttdef"><b>Definition:</b> WorkflowFile.h:26</div></div>
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer">
    <small>
        Generated by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
    </a> 1.8.17
    </small>
</address>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
