<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.17"/>
    <title>WRENCH: Interacting with a storage service</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="bootstrap.min.css">
    <script src="bootstrap.min.js"></script>
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script type="text/javascript" src="jquery.smartmenus.js"></script>
    <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="https://wrench-project.org" class="navbar-brand">
                <img alt="Logo" src="logo-horizontal.png" width="160" style="float: left"/>
                1.7-dev
            </a>
        </div>
        <div id="main-nav" class="nav navbar-nav navbar-right">
            <ul class="sm sm-dox nav navbar-nav navbar-right" id="main-menu">
                <li class="nav-item"><a class="nav-link" href="/wrench/1.7-dev/index.html">Overview</a></li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.7-dev/install.html">Installation</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.7-dev/getting-started.html">Getting
                    Started</a></li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.7-dev/wrench-101.html">WRENCH 101</a>
                </li>
                <li class="nav-item"><a class="nav-link" href="/wrench/1.7-dev/wrench-102.html">WRENCH 102</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">APIs Reference</a>
                    <div class="dropdown-menu">
                        <a class="small dropdown-item" href="/wrench/1.7-dev/user/annotated.html">User</a>
                        <a class="small dropdown-item"
                           href="/wrench/1.7-dev/developer/annotated.html">Developer</a>
                        <a class="small dropdown-item"
                           href="/wrench/1.7-dev/internal/annotated.html">Internal</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="top" style="padding-top: 4em !important"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Interacting with a storage service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Several interactions with a storage service are done simple by calling <b>static methods</b> of the <code><a class="el" href="classwrench_1_1_storage_service.html" title="The storage service base class.">wrench::StorageService</a></code> class. These make it possible to lookup, delete, read, and write files. For instance:</p>
<div class="fragment"><div class="line"><span class="comment">// Get the first simple storage service (assuming there&#39;s at least one)</span></div>
<div class="line"><span class="keyword">auto</span> storage_service = *(this-&gt;getAvailableComputeServices&lt;wrench::SimpleStorageService&gt;().begin());</div>
<div class="line"><span class="comment">// Get the file registry service</span></div>
<div class="line"><span class="keyword">auto</span> file_registry = this-&gt;getAvailableFileRegistryService();</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwrench_1_1_workflow_file.html">wrench::WorkflowFile</a> *some_file = ...;</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check whether the storage service holds the file at path /data/ and delete it if so</span></div>
<div class="line"><span class="keyword">auto</span> file_location = <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/data/&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="classwrench_1_1_storage_service.html#a0e47d707e6233af4d420bdb4f5795fbc">wrench::StorageService::lookupFile</a>(some_file, file_location) {</div>
<div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;File found!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <a class="code" href="classwrench_1_1_storage_service.html#a7f560f5495e575efac5aeb441678503e">wrench::StorageService::deleteFile</a>(some_file, file_location, file_registry);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that the file registry service is passed to the <code><a class="el" href="classwrench_1_1_storage_service.html#a7f560f5495e575efac5aeb441678503e" title="Synchronously delete a file at a location.">wrench::StorageService::deleteFile()</a></code> method since the file deletion should cause the file registry to remove one of its entries.</p>
<p>Reading and writing files is something a WMS typically does not do directly (instead, workflow tasks read and write files as they execute). But, if for some reason a WMS needs to spend time doing file I/O, it is easily done:</p>
<div class="fragment"><div class="line"><span class="comment">// Read some file from the &quot;/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This does nothing but simulate a time overhead during which the WMS is busy</span></div>
<div class="line"><a class="code" href="classwrench_1_1_storage_service.html#ad969be2879e8d0ecca8a322b112e062e">wrench::StorageService::readFile</a>(some_file, <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write some file to the &quot;/stuff/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This simulates a time overhead after which the storage service will host the file. It</span></div>
<div class="line"><span class="comment">// is a good idea to then add an entry to the file registry service</span></div>
<div class="line"><a class="code" href="classwrench_1_1_storage_service.html#a81862260994bb6fd35cb78aa12164d09">wrench::StorageService::writeFile</a>(some_file, <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/stuff/&quot;</span>);</div>
</div><!-- fragment --><p>An operation commonly performed by a WMS is copying files between storage services (e.g., to enforce some data locality). This is typically done by specifying file copy operations as part of standard jobs. But it can also be done manually by the WMS via the data movement manager's methods <code><a class="el" href="classwrench_1_1_data_movement_manager.html#af43bc95ea5f19c5853a0dbfdcaf71d00" title="Ask the data manager to perform a synchronous file copy.">wrench::DataMovementManager::doSynchronousFileCopy()</a></code> and <code><a class="el" href="classwrench_1_1_data_movement_manager.html#aca33489c06e05260fe0a73fb7ee660e0" title="Ask the data manager to initiate an asynchronous file copy.">wrench::DataMovementManager::initiateAsynchronousFileCopy()</a></code>. Here is an example in which a file is copied between storage services:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a data movement manager</span></div>
<div class="line"><span class="keyword">auto</span> data_movement_manager = this-&gt;createDataMovementManager();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Synchronously copy some_file from storage_service1 to storage_service2</span></div>
<div class="line"><span class="comment">// While this is taking place, the WMS is busy</span></div>
<div class="line">data_movement_manager-&gt;doSynchronousFileCopy(some_file, <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service1), <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service2));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Asynchronously copy some_file from storage_service2 to storage_service3</span></div>
<div class="line">data_movement_manager-&gt;initiateAsynchronousFileCopy(some_file, <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service2), <a class="code" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service3));</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for and process the next event (may be a file copy completion or failure)</span></div>
<div class="line">this-&gt;waitForAndProcessNextEvent();</div>
</div><!-- fragment --><p>See the WMS implementation in <code>examples/basic-examples/bare-metal-data-movement/DataMovementWMS.cpp</code> for a more complete example. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclasswrench_1_1_file_location_html_ae62041d1dd72974f5edbb96fa9b73cb1"><div class="ttname"><a href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a></div><div class="ttdeci">static std::shared_ptr&lt; FileLocation &gt; LOCATION(std::shared_ptr&lt; StorageService &gt; ss)</div><div class="ttdoc">File location specifier for a storage service's (single) mount point root.</div><div class="ttdef"><b>Definition:</b> FileLocation.cpp:32</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_a7f560f5495e575efac5aeb441678503e"><div class="ttname"><a href="classwrench_1_1_storage_service.html#a7f560f5495e575efac5aeb441678503e">wrench::StorageService::deleteFile</a></div><div class="ttdeci">static void deleteFile(WorkflowFile *file, std::shared_ptr&lt; FileLocation &gt; location, std::shared_ptr&lt; FileRegistryService &gt; file_registry_service=nullptr)</div><div class="ttdoc">Synchronously delete a file at a location.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:491</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_a81862260994bb6fd35cb78aa12164d09"><div class="ttname"><a href="classwrench_1_1_storage_service.html#a81862260994bb6fd35cb78aa12164d09">wrench::StorageService::writeFile</a></div><div class="ttdeci">static void writeFile(WorkflowFile *file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously write a file to the storage service.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:326</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_a0e47d707e6233af4d420bdb4f5795fbc"><div class="ttname"><a href="classwrench_1_1_storage_service.html#a0e47d707e6233af4d420bdb4f5795fbc">wrench::StorageService::lookupFile</a></div><div class="ttdeci">static bool lookupFile(WorkflowFile *file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously asks the storage service whether it holds a file.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:174</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_ad969be2879e8d0ecca8a322b112e062e"><div class="ttname"><a href="classwrench_1_1_storage_service.html#ad969be2879e8d0ecca8a322b112e062e">wrench::StorageService::readFile</a></div><div class="ttdeci">static void readFile(WorkflowFile *file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously read a file from the storage service.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:223</div></div>
<div class="ttc" id="aclasswrench_1_1_workflow_file_html"><div class="ttname"><a href="classwrench_1_1_workflow_file.html">wrench::WorkflowFile</a></div><div class="ttdoc">A data file used/produced by a WorkflowTask in a Workflow.</div><div class="ttdef"><b>Definition:</b> WorkflowFile.h:26</div></div>
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<div class="footer">
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <p>
                    <strong>&copy;2017-2020 WRENCH. All Rights Reserved.</strong><br />
                </p>
                <p style="padding-top: 1em">
                    <a href="mailto:support@wrench-project.org" class="fa-stack fa-2x" style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fa fa-envelope fa-stack-1x"></i>
                    </a>
                    <a href="http://twitter.com/wrenchproject" target="_blank" class="fa-stack fa-2x"
                       style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fab fa-twitter fa-stack-1x"></i>
                    </a>
                    <a href="https://github.com/wrench-project/wrench" target="_blank" class="fa-stack fa-2x"
                       style="font-size: 1.5em">
                        <i class="fa fa-circle fa-stack-2x" style="color: #fff"></i>
                        <i class="fab fa-github fa-stack-1x"></i>
                    </a>
                </p>
            </div>
            <div class="col-sm-4 text-center">
            </div>
            <div class="col-sm-4">
                <p>WRENCH is funded by the National Science Foundation (NSF) under grants number <a
                        href="https://nsf.gov/awardsearch/showAward?AWD_ID=1642369" target="_blank">1642369</a>,
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1642335" target="_blank">1642335</a>,
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923539" target="_blank">1923539</a>, and
                    <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923621" target="_blank">1923621</a>;
                    and the National Center for Scientific Research (CNRS) under grant number PICS07239.
                </p>
                <p style="font-weight: normal; font-size: 0.8em; margin-top: 1em">
                    Any opinions, findings, and conclusions or recommendations expressed in this material are those
                    of the author(s) and do not necessarily reflect the views of the National Science Foundation.
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
